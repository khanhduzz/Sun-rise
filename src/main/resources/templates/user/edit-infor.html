<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Edit User Information</title>
    <!-- Custom fonts for this template-->
    <link th:href="@{/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,600,700,800,900" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link th:href="@{/css/sb-admin-2.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css/bootstrap-icons.min.css}" rel="stylesheet" type="text/css">

    <!-- External styles -->
    <link th:href="@{/css/styles.css}" rel="stylesheet" type="text/css">
</head>

<body id="page-top">
<div id="wrapper">
    <!-- Tab Bar -->
    <div th:replace="~{tab_bar :: tab-bar}"></div>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
            <!-- Header -->
            <div th:replace="~{header :: header}"></div>

            <!-- Main Content -->
            <div class="container-fluid d-flex justify-content-center align-items-center" style="min-height: 100vh;">
                <div class="card shadow mb-4" style="width: 50%;">
                    <div class="card-header py-3 text-center">
                        <h6 class="m-0 font-weight-bold text-primary" style="font-size: 1.5rem;">
                            Edit User Information
                        </h6>
                    </div>

                    <div class="card-body edit-info-container">
                        <h2 class="edit-info-title">Edit Your Information</h2>

                        <form th:action="@{/user/edit-infor}" method="post" enctype="multipart/form-data" th:object="${userInfor}" onsubmit="return validateForm()">
                            <!-- Avatar Upload -->
                            <div class="form-group">
                                <label for="avatar">Avatar (Max 2MB, PNG, WEBP, RAW, JPG, JPEG):</label>
                                <input type="file" class="form-control-file" id="avatar" name="avatar" accept=".png,.jpg,.jpeg,.webp,.raw" onchange="previewAvatar()">
                                <div>
                                    <img id="avatarPreview"
                                         th:src="${userInfor.avatarUrl != null ? userInfor.avatarUrl : '/sun/img/undraw_profile.svg'}"
                                         alt="User Avatar" class="img-thumbnail" width="150">
                                </div>
                            </div>

                            <!-- Username (Read Only) -->
                            <div class="form-group">
                                <label for="username">Username:</label>
                                <input type="text" class="form-control" id="username" th:field="*{username}" readonly>
                            </div>

                            <!-- First Name -->
                            <div class="form-group">
                                <label for="firstname">First Name:</label>
                                <input type="text" class="form-control" id="firstname" th:field="*{firstname}" placeholder="Enter your first name">
                            </div>

                            <!-- Last Name -->
                            <div class="form-group">
                                <label for="lastname">Last Name:</label>
                                <input type="text" class="form-control" id="lastname" th:field="*{lastname}" placeholder="Enter your last name">
                            </div>

                            <!-- Email -->
                            <div class="form-group">
                                <label for="email">Email:</label>
                                <input type="email" class="form-control" id="email" th:field="*{email}" placeholder="Enter your email">
                            </div>

                            <!-- Phone -->
                            <div class="form-group">
                                <label for="phone">Phone:</label>
                                <input type="tel" class="form-control" id="phone" th:field="*{phone}" placeholder="Enter your phone number">
                            </div>

                            <!-- New Password -->
                            <div class="form-group">
                                <label for="password">New Password:</label>
                                <input type="password" class="form-control" id="password" th:field="*{password}" placeholder="Enter new password">
                            </div>

                            <!-- Confirm Password -->
                            <div class="form-group">
                                <label for="confirmPassword">Confirm Password:</label>
                                <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm your new password">
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn-primary">Save Changes</button>

                            <!-- Error Display -->
                            <div class="mt-3">
                                <span th:if="${error}" class="text-danger" th:text="${error}"></span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div th:replace="~{footer :: footer}"></div>
        </div>
    </div>
</div>

<script>
    const MAX_FILE_SIZE = 2 * 1024 * 1024;  // 2MB
    const ALLOWED_TYPES = ['image/png', 'image/webp', 'image/raw', 'image/jpeg', 'image/jpg'];

    function previewAvatar() {
        const fileInput = document.getElementById("avatar");
        const file = fileInput.files[0];

        if (!file) {
            alert("No file selected.");
            return;
        }

        if (!ALLOWED_TYPES.includes(file.type)) {
            alert("Invalid file type. Only png, webp, raw, jpg, jpeg are allowed.");
            fileInput.value = "";
            return;
        }

        if (file.size > MAX_FILE_SIZE) {
            alert("File exceeds maximum size of 2MB.");
            fileInput.value = "";
            return;
        }

        const reader = new FileReader();
        reader.onload = function(event) {
            document.getElementById("avatarPreview").src = event.target.result;
        };
        reader.readAsDataURL(file);
    }

    function validateForm() {
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        if (password && password !== confirmPassword) {
            alert("Passwords do not match.");
            return false;  // Prevent form submission
        }

        return true;  // Allow form submission
    }
</script>
</body>
</html>
